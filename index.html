<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Handwritten Digit Image Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border-top-color: #3498db;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    <div class="container mx-auto px-4 py-8 max-w-2xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 dark:text-white">Handwritten Digit Image Generator</h1>
            <p class="text-gray-600 dark:text-gray-400 mt-2">Generate synthetic MNIST-like images using an AI model.</p>
        </header>

        <main>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8">
                <div class="flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <div class="w-full sm:w-auto">
                        <label for="digit-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Choose a digit to generate (0-9):</label>
                        <select id="digit-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                            <option selected value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                        </select>
                    </div>
                    <button id="generate-btn" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-5 rounded-lg transition duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-blue-300 dark:focus:ring-blue-800">
                        Generate Images
                    </button>
                </div>
            </div>

            <div id="image-container" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                 <h2 id="generated-title" class="text-2xl font-bold text-center text-gray-800 dark:text-white mb-6 hidden">Generated images</h2>
                <div id="loader" class="hidden loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-32 w-32 mx-auto"></div>
                <div id="image-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4">
                    <!-- Generated images will be appended here -->
                </div>
                <div id="error-message" class="hidden text-center text-red-500 mt-4"></div>
            </div>
        </main>
    </div>

    <script>
        const generateBtn = document.getElementById('generate-btn');
        const digitSelect = document.getElementById('digit-select');
        const imageGrid = document.getElementById('image-grid');
        const generatedTitle = document.getElementById('generated-title');
        const loader = document.getElementById('loader');
        const errorMessage = document.getElementById('error-message');

        generateBtn.addEventListener('click', async () => {
            const selectedDigit = digitSelect.value;
            imageGrid.innerHTML = ''; // Clear previous images
            errorMessage.classList.add('hidden');
            generatedTitle.classList.add('hidden');
            loader.classList.remove('hidden');

            const promptText = `Generate a 28x28 grayscale image of a handwritten digit '${selectedDigit}', in the style of the MNIST dataset. The background should be black and the digit white.`;

            try {
                // This is a placeholder for the actual API call.
                // In a real application, you would make a fetch request here.
                const imagePromises = Array(5).fill(null).map(() => generateImage(promptText));
                const results = await Promise.all(imagePromises);

                loader.classList.add('hidden');
                generatedTitle.innerText = `Generated images of digit ${selectedDigit}`;
                generatedTitle.classList.remove('hidden');

                results.forEach((base64Data, index) => {
                     if (base64Data) {
                        const imgContainer = document.createElement('div');
                        imgContainer.className = 'text-center';

                        const img = document.createElement('img');
                        img.src = `data:image/png;base64,${base64Data}`;
                        img.alt = `Generated handwritten digit ${selectedDigit}`;
                        img.className = 'bg-black rounded-lg shadow-md mx-auto';

                        const p = document.createElement('p');
                        p.textContent = `Sample ${index + 1}`;
                        p.className = 'text-sm text-gray-600 dark:text-gray-400 mt-2';

                        imgContainer.appendChild(img);
                        imgContainer.appendChild(p);
                        imageGrid.appendChild(imgContainer);
                    }
                });

            } catch (error) {
                console.error('Error generating images:', error);
                loader.classList.add('hidden');
                errorMessage.textContent = 'Failed to generate images. Please try again.';
                errorMessage.classList.remove('hidden');
            }
        });

        async function generateImage(prompt) {
            // This function simulates an API call to an image generation model.
            // Replace this with your actual API call.
            const payload = {
                instances: [{ prompt: prompt }],
                parameters: { "sampleCount": 1 }
            };
            const apiKey = ""; // The API key will be automatically provided by the environment.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                    return result.predictions[0].bytesBase64Encoded;
                } else {
                    console.error("Unexpected API response:", result);
                    return null;
                }
            } catch (error) {
                console.error("API call failed:", error);
                throw error;
            }
        }
    </script>
</body>
</html>
